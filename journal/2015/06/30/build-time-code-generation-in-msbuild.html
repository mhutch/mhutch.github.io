<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Build Time Code Generation in MSBuild &middot; mhut.ch
    
  </title>

  <script>
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-M9VCVCX');
</script>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface&text=mhut.ch" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Build Time Code Generation in MSBuild | mhut.ch</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Build Time Code Generation in MSBuild" />
<meta name="author" content="Mikayla Hutchinson" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Build-time code generation is a really powerful way to automate repetitive parts of your code. It can save time, reduce frustration, and eliminate a source of copy/paste bugs. This is something I’m familiar with due to my past work on MonoDevelop’s tooling for ASP.NET, T4 and Moonlight, and designing and/or implementing similar systems for Xamarin.iOS and Xamarin.Android. However, I haven’t seen any good documentation on it, so I decided to write an article to outline the basics." />
<meta property="og:description" content="Build-time code generation is a really powerful way to automate repetitive parts of your code. It can save time, reduce frustration, and eliminate a source of copy/paste bugs. This is something I’m familiar with due to my past work on MonoDevelop’s tooling for ASP.NET, T4 and Moonlight, and designing and/or implementing similar systems for Xamarin.iOS and Xamarin.Android. However, I haven’t seen any good documentation on it, so I decided to write an article to outline the basics." />
<link rel="canonical" href="https://mhut.ch/journal/2015/06/30/build-time-code-generation-in-msbuild" />
<meta property="og:url" content="https://mhut.ch/journal/2015/06/30/build-time-code-generation-in-msbuild" />
<meta property="og:site_name" content="mhut.ch" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-06-30T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Build Time Code Generation in MSBuild" />
<meta name="twitter:site" content="@mjhutchinson" />
<meta name="twitter:creator" content="@mjhutchinson" />
<script type="application/ld+json">
{"description":"Build-time code generation is a really powerful way to automate repetitive parts of your code. It can save time, reduce frustration, and eliminate a source of copy/paste bugs. This is something I’m familiar with due to my past work on MonoDevelop’s tooling for ASP.NET, T4 and Moonlight, and designing and/or implementing similar systems for Xamarin.iOS and Xamarin.Android. However, I haven’t seen any good documentation on it, so I decided to write an article to outline the basics.","url":"https://mhut.ch/journal/2015/06/30/build-time-code-generation-in-msbuild","@type":"BlogPosting","headline":"Build Time Code Generation in MSBuild","dateModified":"2015-06-30T00:00:00+00:00","datePublished":"2015-06-30T00:00:00+00:00","author":{"@type":"Person","name":"Mikayla Hutchinson"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://mhut.ch/journal/2015/06/30/build-time-code-generation-in-msbuild"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


  <body class="journal">
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M9VCVCX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div id="sidebar">
  <header>
    <img class="hero-avatar" src="/files/mikayla-small.jpg" alt="Mikayla" />
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        mhut.ch
      </a>
    </div>
    <p class="lead">Mikayla Hutchinson's home on the web</p>
  </header>
  <nav id="sidebar-nav-links">
    <a class="page-link" href="/">Home</a>
    <a class="page-link" href="/about">About</a>
    <a class="page-link" href="/journal">Journal</a>
    <a class="page-link" href="/talks">Talks</a>
    <a class="page-link" href="/contact">Contact</a></nav>

  <nav id="sidebar-icon-links">
  <a id="github-link"
    class="icon "
    title="Find me on GitHub" aria-label="Find me on GitHub"
    href="https://github.com/mhutch">
    <svg aria-hidden="true" data-prefix="fab" data-icon="github-alt" class="svg-inline--fa fa-github-alt fa-w-15" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path fill="currentColor" d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg>
  </a>
  <a id="twitter-link"
    class="icon "
    title="Find me on Twitter" aria-label="Find me on Twitter"
    href="https://twitter.com/mjhutchinson">
    <svg aria-hidden="true" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
  </a>
  <a id="mastodon-link"
    class="icon "
    title="Find me on Mastodon" aria-label="Find me on Mastodon"
    href="https://mastodon.social/@mhutch">
    <svg aria-hidden="true" data-prefix="fab" data-icon="mastodon" class="svg-inline--fa fa-mastodon fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 417 512"><path fill="currentColor" d="M417.8 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.5-28.4-290.4 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.4-.9-9-.9-13.9 85.6 20.9 158.6 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zm-75.1 125.2h-46.6V190.1c0-49.7-64-51.6-64 6.9v62.5h-46.3V197c0-58.5-64-56.6-64-6.9v114.2H75.1c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175z"></path></svg>
  </a>
  <a id="linkedin-link"
    class="icon "
    title="Find me on LinkedIn" aria-label="Find me on LinkedIn"
    href="https://linkedin.com/in/mjhutchinson">
    <svg aria-hidden="true" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
  </a>
  <a id="subscribe-link"
    class="icon "
    title="Subscribe" aria-label="Subscribe"
    href="https://mhut.ch/feed.xml">
    <svg aria-hidden="true" data-prefix="fas" data-icon="rss" class="svg-inline--fa fa-rss fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg>
  </a>
  <a id="tags-link"
    class="icon "
    title="Tags" aria-label="Tags"
    href="https://mhut.ch/tags">
    <svg aria-hidden="true" data-prefix="fas" data-icon="tags" class="svg-inline--fa fa-tags fa-w-20" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"></path></svg>
  </a>
  <a id="search-link"
    class="icon "
    title="Search" aria-label="Search"
    href="https://mhut.ch/search">
    <svg aria-hidden="true" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
  </a></nav>
  <p class="copyright">
  <a href="/terms">Personal site, opinions mine. &copy; 2021</a>
</p>

</div>

    <main class="container">
      <header>
  <h1 class="post-title">Build Time Code Generation in MSBuild</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">30 Jun 2015</span>
  <span class="post-categories">
    
  </span>
</div>


  <div class="post-body">
    <p>Build-time code generation is a really powerful way to automate repetitive parts
of your code. It can save time, reduce frustration, and eliminate a source of
copy/paste bugs.</p>

<p>This is something I’m familiar with due to my past work on MonoDevelop’s tooling
for ASP.NET, T4 and Moonlight, and designing and/or implementing similar systems
for Xamarin.iOS and Xamarin.Android. However, I haven’t seen any good
documentation on it, so I decided to write an article to outline the
basics.<!--break--></p>

<p>This isn’t just something for custom project types, it’s also something that you
can include in NuGets, since they can include MSBuild logic.</p>

<h2 id="background">Background</h2>

<p>The basic idea is to generate C# code from other files in the project, and
include it in the build. This can be to generate helpers, for example CodeBehind
for views (ASPX, XAML), or to process simple DSLs (T4), or any other purpose you
can imagine.</p>

<p>MSBuild makes this pretty easy. You can simply hook a custom target before the
<code class="language-plaintext highlighter-rouge">Compile</code> target, and have it emit a <code class="language-plaintext highlighter-rouge">Compile</code> item based on whatever input
items you want. For the purposes of this guide I’m going to assume you’re
comfortable with enough MSBuild to understand that - if you’re not, the <a href="https://msdn.microsoft.com/en-us/library/dd637714.aspx">MSDN
docs</a> are pretty good
for the basics.</p>

<p>The challenge is to include the generated C# in code completion, and update it
automatically.</p>

<p>An IDE plugin can do this fairly easily - see for example the <em>Generator</em>
mechanism used by T4, and the <code class="language-plaintext highlighter-rouge">*.designer.cs</code> file generated by the old Windows
Forms and ASP.NET designers. However, doing it this way has several downsides,
for example you have to check their output into source control, and they won’t
update if you edit files outside the IDE. Build-time generation, as used for
XAML, is a better option in most cases.</p>

<p>This article describes how to implement the same model used by
WPF/Silverlight/Xamarin.Forms XAML.</p>

<h2 id="generating-the-code">Generating the Code</h2>

<p>First, you need a build target that updates the generated files, emits them into
the intermediate output directory, and injects them to the <code class="language-plaintext highlighter-rouge">Compile</code>
<code class="language-plaintext highlighter-rouge">ItemGroup</code>. For the purposes of this article I’ll call it
<code class="language-plaintext highlighter-rouge">UpdateGeneratedFiles</code> and assume that it’s processing <code class="language-plaintext highlighter-rouge">ResourceFile</code> items and
emitting a file called <code class="language-plaintext highlighter-rouge">GeneratedCode.g.cs</code>. In a real implementation, you
should use unique names won’t conflict with other targets, items and files.</p>

<p>For example:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"UpdateGeneratedFiles"</span>
  <span class="na">DependsOnTargets=</span><span class="s">"_UpdateGeneratedFiles"</span>
  <span class="na">Condition=</span><span class="s">="'@(ResourceFile)'</span> <span class="err">!=</span> <span class="err">''"</span>
<span class="nt">&gt;</span>
  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;Compile</span> <span class="na">Include=</span><span class="s">"$(IntermediateOutputPath)GeneratedFile.g.cs"</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- see https://mhut.ch/journal/2016/04/19/msbuild_code_generation_vs2015
    &lt;FileWrites Include="$(IntermediateOutputPath)GeneratedFile.g.cs" /&gt;
    --&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>
<span class="nt">&lt;/Target&gt;</span>
<span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"_UpdateGeneratedFiles"</span>
  <span class="na">Inputs=</span><span class="s">"$(MSBuildProjectFile);@(ResourceFile)"</span>
  <span class="na">Outputs=</span><span class="s">"$(IntermediateOutputPath)GeneratedFile.g.cs"</span>
<span class="nt">&gt;</span>
  <span class="nt">&lt;FileGenerationTask</span>
      <span class="na">Inputs=</span><span class="s">"@(ResourceFile)"</span>
      <span class="na">Output=</span><span class="s">"$(IntermediateOutputPath)GeneratedFile.g.cs"</span>
  <span class="nt">&gt;</span>
<span class="nt">&lt;/Target&gt;</span>
</code></pre></div></div>

<p>A quick breakdown:</p>

<p>The <code class="language-plaintext highlighter-rouge">UpdateGeneratedFiles</code> target runs if you have any <code class="language-plaintext highlighter-rouge">ResourceFile</code> items. It
injects the generated file into the build as a <code class="language-plaintext highlighter-rouge">Compile</code> item, and also injects
a <code class="language-plaintext highlighter-rouge">FileWrites</code> item so the file is recorded for incremental clean. It depends on
the ‘real’ generation target, <code class="language-plaintext highlighter-rouge">_UpdateGeneratedFiles</code>, so that the file is
generated before the <code class="language-plaintext highlighter-rouge">UpdateGeneratedFiles</code> target runs.</p>

<p>The <code class="language-plaintext highlighter-rouge">_UpdateGeneratedFiles</code> target has <code class="language-plaintext highlighter-rouge">Inputs</code> and <code class="language-plaintext highlighter-rouge">Outputs</code> set, so that it is
incremental. The target will be skipped if the output file exists is newer than
all of the input files - the project file and the resource files.</p>

<p>The project file is included in the inputs list because its write time will
change if the list of resource files changes.</p>

<p>The <code class="language-plaintext highlighter-rouge">_UpdateGeneratedFiles</code> target simply runs a tasks that generates the output
file from the input files.</p>

<p>Note that the generated file has the suffix <code class="language-plaintext highlighter-rouge">.g.cs</code>. This is the convention for
built-time generated files. The <code class="language-plaintext highlighter-rouge">.designer.cs</code> suffix is used for user-visible
files generated at design-time by the designer.</p>

<h2 id="hooking-into-the-build">Hooking into the Build</h2>

<p>The <code class="language-plaintext highlighter-rouge">UpdateGeneratedFiles</code> target is added to the dependencies of the <code class="language-plaintext highlighter-rouge">CoreCompile</code> target by prepending it to the <code class="language-plaintext highlighter-rouge">CoreCompileDependsOn</code> property.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;PropertyGroup&gt;</span>
  <span class="nt">&lt;CoreCompileDependsOn&gt;</span>UpdateGeneratedFiles;$(CoreCompileDependsOn)<span class="nt">&lt;/CoreCompileDependsOn&gt;</span>
<span class="nt">&lt;/PropertyGroup&gt;</span>
</code></pre></div></div>

<p>This means that whenever the the project is compiled, the generated file is
generated or updated if necessary, and the injected <code class="language-plaintext highlighter-rouge">Compile</code> item is injected
before the compiler is called, so is passed to the compiler - though it never
exists in the project file itself.</p>

<h2 id="live-update-on-project-change">Live Update on Project Change</h2>

<p>So how do the types from the generated file show up in code completion before
the project has been compiled? This takes advantage of the way that Visual
Studio initializes its in-process compiler that’s used for code completion.</p>

<p>When the project is loaded in Visual Studio, or when the project file is
changed, Visual Studio runs the <code class="language-plaintext highlighter-rouge">CoreCompile</code> target. It intercepts the call to
the compiler via a host hook in the the MSBuild <code class="language-plaintext highlighter-rouge">Csc</code> task and uses the file
list and arguments to initialize the in-process compiler.</p>

<p>Because <code class="language-plaintext highlighter-rouge">UpdateGeneratedFiles</code> is a dependency of <code class="language-plaintext highlighter-rouge">CoreCompile</code>, this means that
the generated file is updated before the code completion system is initialized,
and the injected file is passed to the code completion system.</p>

<p>Note that the <code class="language-plaintext highlighter-rouge">UpdateGeneratedFiles</code> target has to be fast, or it will add
latency to code completion availability when first loading the project or after
cleaning it.</p>

<h2 id="live-update-on-file-change">Live Update on File Change</h2>

<p>So, the generated code is updated whenever the project changes. But what happens when the contents of the <code class="language-plaintext highlighter-rouge">ResourceFile</code> files that it depends on change?</p>

<p>This is handled via Generator metadata on each of the <code class="language-plaintext highlighter-rouge">ResourceFile</code> files:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ItemGroup&gt;</span>
  <span class="nt">&lt;ResourceFile</span> <span class="na">Include=</span><span class="s">"Foo.png"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Generator&gt;</span>MSBuild:UpdateGeneratedFiles<span class="nt">&lt;/Generator&gt;</span>
  <span class="nt">&lt;/ResourceFile&gt;</span>
<span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre></div></div>

<p>This takes advantage of another Visual Studio feature. Whenever the file is
saved, VS runs the <code class="language-plaintext highlighter-rouge">UpdateGeneratedFiles</code> target. The code completion system
detects the change to the generated file and reparses it.</p>

<p>This metadata has to be applied to the items by the IDE (or the user). It may be
possible for the build targets to apply it automatically using an
<code class="language-plaintext highlighter-rouge">ItemDefinitionGroup</code> but I haven’t tested whether VS respects this for
<code class="language-plaintext highlighter-rouge">Generator</code> metadata.</p>

<h2 id="xamarin-studiomonodevelop">Xamarin Studio/MonoDevelop</h2>

<p>But we have another problem. What about Xamarin Studio/MonoDevelop?</p>

<p>Although Xamarin Studio respects <code class="language-plaintext highlighter-rouge">Generator</code> metadata, it doesn’t have an
in-process compiler. It doesn’t run <code class="language-plaintext highlighter-rouge">CoreCompile</code>, nor does it intercept the
<code class="language-plaintext highlighter-rouge">Csc</code> file list, so its code completion system won’t see the generated file at
all.</p>

<p>The solution - for now - is to add explicit support in a <a href="/addinmaker">Xamarin Studio
addin</a> to run the <code class="language-plaintext highlighter-rouge">UpdateGeneratedFiles</code> target on
project load and when the resource files change, parse the generated file and
inject it into the type system directly.</p>

<h2 id="migration">Migration</h2>

<p>Migrating automatically from a designer-generation system to a build-generation
system has a few implications.</p>

<p>You either have to force migration of the project to the new system via an IDE,
or handle the old system and make the migration optional - e.g. toggled by the
presence of the old files. You have to update the project templates and samples,
and you have to build a migration system that removes the designer files from
the project and adds Generator metadata to existing files.</p>

    <div class="post-tags">
  
    <a href="/tags/mono">
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">mono</span>
    </a>
  
</div>
    
<ul class="breadcrumb">
    <li><a href="/journal">Journal</a></li>
    <li><a href="/journal/2015/">2015</a></li>
    <li><a href="/journal/2015/06/">06</a></li>
</ul>

    <div class="share-links">
  <span class="share-text">Share this:</span>
  <ul>
    <li id="twitter-share-link" class="twitter-icon">
      <a href="https://twitter.com/intent/tweet?text=Build Time Code Generation in MSBuild&url=https://mhut.ch/journal/2015/06/30/build-time-code-generation-in-msbuild&via=mjhutchinson&related=mjhutchinson" rel="nofollow" target="_blank" title="Tweet this">
        <svg aria-hidden="true" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
      </a>
    </li>
    <li id="facebook-share-link" class="facebook-icon">
      <a href="https://facebook.com/sharer.php?u=https://mhut.ch/journal/2015/06/30/build-time-code-generation-in-msbuild" rel="nofollow" target="_blank" title="Share on Facebook">
        <svg aria-hidden="true" data-prefix="fab" data-icon="facebook" class="svg-inline--fa fa-facebook fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M448 56.7v398.5c0 13.7-11.1 24.7-24.7 24.7H309.1V306.5h58.2l8.7-67.6h-67v-43.2c0-19.6 5.4-32.9 33.5-32.9h35.8v-60.5c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9h-58.4v67.6h58.4V480H24.7C11.1 480 0 468.9 0 455.3V56.7C0 43.1 11.1 32 24.7 32h398.5c13.7 0 24.8 11.1 24.8 24.7z"></path></svg>
      </a>
    </li>
    <li id="googleplus-share-link" class="googleplus-icon">
      <a href="https://plus.google.com/share?url=https://mhut.ch/journal/2015/06/30/build-time-code-generation-in-msbuild" rel="nofollow" target="_blank" title="Share on Google+">
        <svg aria-hidden="true" data-prefix="fab" data-icon="google-plus" class="svg-inline--fa fa-google-plus fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111.1 8 0 119.1 0 256s111.1 248 248 248 248-111.1 248-248S384.9 8 248 8zm-70.7 372c-68.8 0-124-55.5-124-124s55.2-124 124-124c31.3 0 60.1 11 83 32.3l-33.6 32.6c-13.2-12.9-31.3-19.1-49.4-19.1-42.9 0-77.2 35.5-77.2 78.1s34.2 78.1 77.2 78.1c32.6 0 64.9-19.1 70.1-53.3h-70.1v-42.6h116.9c1.3 6.8 1.9 13.6 1.9 20.7 0 70.8-47.5 121.2-118.8 121.2zm230.2-106.2v35.5H372v-35.5h-35.5v-35.5H372v-35.5h35.5v35.5h35.2v35.5h-35.2z"></path></svg>
      </a>
    </li>
    <li id="linkedin-share-link" class="linkedin-icon">
      <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://mhut.ch/journal/2015/06/30/build-time-code-generation-in-msbuild&title=Build Time Code Generation in MSBuild&summary=&source=mjhutchinson" rel="nofollow" target="_blank" title="Share on LinkedIn">
        <svg aria-hidden="true" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
      </a>
    </li>
    <li id="pinterest-share-link" class="pinterest-icon">
      <a href="http://pinterest.com/pin/create/button/?url=https://mhut.ch/journal/2015/06/30/build-time-code-generation-in-msbuild" rel="nofollow" target="_blank" title="Pin this">
        <svg aria-hidden="true" data-prefix="fab" data-icon="pinterest" class="svg-inline--fa fa-pinterest fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6 0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8 0 128.7-68.8 128.7-154.3 0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1 0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6 0-54.7 41.4-107.6 112-107.6 60.9 0 103.6 41.5 103.6 100.9 0 67.1-33.9 113.6-78 113.6-24.3 0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6 0-19-10.2-34.9-31.4-34.9-24.9 0-44.9 25.7-44.9 60.2 0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9 0 361.1 0 256 0 119 111 8 248 8s248 111 248 248z"></path></svg>
      </a>
    </li>
    <li id="tumblr-share-link" class="tumblr-icon">
      <a href="http://www.tumblr.com/share/link?url=https://mhut.ch/journal/2015/06/30/build-time-code-generation-in-msbuild" rel="nofollow" target="_blank" title="Share on tumblr">
        <svg aria-hidden="true" data-prefix="fab" data-icon="tumblr" class="svg-inline--fa fa-tumblr fa-w-10" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M309.8 480.3c-13.6 14.5-50 31.7-97.4 31.7-120.8 0-147-88.8-147-140.6v-144H17.9c-5.5 0-10-4.5-10-10v-68c0-7.2 4.5-13.6 11.3-16 62-21.8 81.5-76 84.3-117.1.8-11 6.5-16.3 16.1-16.3h70.9c5.5 0 10 4.5 10 10v115.2h83c5.5 0 10 4.4 10 9.9v81.7c0 5.5-4.5 10-10 10h-83.4V360c0 34.2 23.7 53.6 68 35.8 4.8-1.9 9-3.2 12.7-2.2 3.5.9 5.8 3.4 7.4 7.9l22 64.3c1.8 5 3.3 10.6-.4 14.5z"></path></svg>
      </a>
    </li>
    <li id="reddit-share-link" class="reddit-icon">
      <a href="http://www.reddit.com/submit?url=https://mhut.ch/journal/2015/06/30/build-time-code-generation-in-msbuild" rel="nofollow" target="_blank" title="Submit to Reddit">
        <svg aria-hidden="true" data-prefix="fab" data-icon="reddit" class="svg-inline--fa fa-reddit fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"></path></svg>
      </a>
    </li>
    <li id="email-share-link" class="email-icon">
      <a href="mailto:?subject=Build Time Code Generation in MSBuild&body=Check out this article https://mhut.ch/journal/2015/06/30/build-time-code-generation-in-msbuild" rel="nofollow" target="_blank" title="Email link">
        <svg aria-hidden="true" data-prefix="far" data-icon="envelope" class="svg-inline--fa fa-envelope fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"></path></svg>
      </a>
    </li></ul>
</div>
  </div>

  <section class="comments">
    
  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
    this.page.url = "https://mhut.ch/journal/2015/06/30/build-time-code-generation-in-msbuild";
    this.page.identifier = "" ||
                           "https://mhut.ch/journal/2015/06/30/build-time-code-generation-in-msbuild";
  };
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://mhutch.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  </section>
  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
    <li>
      <h3>
        <a href="/journal/2016/08/03/easy-pull-requests-from-master-with-git-offload">Easy pull requests from master with git-offload</a>
        <small>2016 Aug 3</small>
      </h3>
    </li>
    <li>
      <h3>
        <a href="/journal/2016/04/19/msbuild-code-generation-in-vs2015">MSBuild Code Generation in VS2015</a>
        <small>2016 Apr 19</small>
      </h3>
    </li>
    <li>
      <h3>
        <a href="/journal/2015/03/12/monodevelop-addinmaker-1-2">MonoDevelop.AddinMaker 1.2</a>
        <small>2015 Mar 12</small>
      </h3>
    </li>
    </ul>
</section>
</div>

    </main>
  </body>
</html>
